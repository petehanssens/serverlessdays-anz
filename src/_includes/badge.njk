---
layout: base.njk
---
<div class="ph3 ph0-ns pt4 pt6-ns w-100 contrastBkg contrastColor">
    <div class="w-100 w-80-m w-60-l center">
        <h1 class="f1">Virtual Badge</h1>
    </div>

    <div class="markdown-body mw6-m mw7-l avenir center">
        {{ content | safe }}
    </div>
    <div class="markdown-body mw6-m mw7-l avenir center">
        <form class="flex flex-column" id="uploadForm">
            <input type="text" id="name" name="name" class="ma2 pa2" placeholder="Name" maxlength="36" required>
            <input type="text" id="title" name="title" class="ma2 pa2" placeholder="Title" maxlength="68" required>
            <input type="file" id="headshot" name="headshot" class="dn">
            <label for="headshot" class="ma2 pa2 secondaryContrastColor secondaryConstrastBkg br2 center">📷 Choose Headshot</label>
            <button type="submit" class="ma2 pa4 primaryBkg primaryColor br4 f4 b">Generate</button>
            <p id="badgeStatus">&nbsp;</p>
        </form>
    </div>
    <div id="imageContainer" class="mw6-m mw6-l center"></div>

    <script type="application/javascript">
        const form = document.getElementById('uploadForm');
        const imageContainer = document.getElementById('imageContainer');
        const messageElement = document.getElementById('badgeStatus');

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const textName = document.getElementById('name');
            const textTitle = document.getElementById('title');
            const fileHeadshot = document.getElementById('headshot');

            let validationMessages = [];

            if (!textName.value.trim()) {
              validationMessages.push("Missing Name");
            }
            if (!textTitle.value.trim()) {
              validationMessages.push("Missing Title");
            }
            if (!fileHeadshot.files.length) {
              validationMessages.push("Missing Headshot");
            }

            if (validationMessages.length > 0) {
              messageElement.textContent = validationMessages.join(', ');
              messageElement.style.color = 'red';
              return;
            }

            messageElement.textContent = "Generating...";
            messageElement.style.color = "blue";

            const formData = new FormData();
            formData.append('name', textName.value);
            formData.append('title', textTitle.value);
            formData.append('headshot', fileHeadshot.files[0]);

            fetch('https://aqwck9wtp5.execute-api.us-east-1.amazonaws.com/badge', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const imageUrl = data.uri;

                const aElement = document.createElement('a');
                aElement.href = imageUrl;
                aElement.download = true;

                const imgElement = document.createElement('img');
                imgElement.src = imageUrl;

                imageContainer.innerHTML = ''; // Clear previous images
                imageContainer.appendChild(aElement);
                aElement.appendChild(imgElement);

                messageElement.textContent = '';
            })
            .catch(error => {
                console.error('Error:', error);
                messageElement.textContent = '⛔️ Error uploading the file (JPG/PNG)';
                messageElement.style.color = 'red';
            });
        });
    </script>
</div>
